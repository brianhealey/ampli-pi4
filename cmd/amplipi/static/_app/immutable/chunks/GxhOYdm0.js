import{G,L as ae,a2 as j,q as A,S as x,a3 as ue,M as ce,g as m,O as fe,Q as le,R as B,T as Z,I as L,a4 as de,a5 as he,a6 as K,k as ge,a7 as N,H as J,a8 as ve,K as pe,a9 as Se,z as me,aa as q,ab as _e,ac as Ee,m as Te,ad as U,ae as Ae,D as ee,F as re,af as k,ag as te,ah as ye,ai as Ne,aj as Oe,E as be,ak as Pe,al as Ie,am as se,an as we,ao as Ce,ap as Re,aq as De,a as y,b as H,s as T,u as Y}from"./BUyZVbJa.js";function Ue(e,r){return r}function $e(e,r,t){for(var s=[],o=r.length,u,i=r.length,d=0;d<o;d++){let E=r[d];re(E,()=>{if(u){if(u.pending.delete(E),u.done.add(E),u.pending.size===0){var g=e.outrogroups;F(q(u.done)),g.delete(u),g.size===0&&(e.outrogroups=null)}}else i-=1},!1)}if(i===0){var a=s.length===0&&t!==null;if(a){var h=t,c=h.parentNode;Oe(c),c.append(h),e.items.clear()}F(r,!a)}else u={pending:new Set(r),done:new Set},(e.outrogroups??=new Set).add(u)}function F(e,r=!0){for(var t=0;t<e.length;t++)be(e[t],r)}var V;function Ye(e,r,t,s,o,u=null){var i=e,d=new Map,a=(r&j)!==0;if(a){var h=e;i=A?x(ue(h)):h.appendChild(G())}A&&ce();var c=null,E=Se(()=>{var f=t();return me(f)?f:f==null?[]:q(f)}),g,p=!0;function b(){n.fallback=c,He(n,g,i,r,s),c!==null&&(g.length===0?(c.f&N)===0?ee(c):(c.f^=N,z(c,null,i)):re(c,()=>{c=null}))}var w=ae(()=>{g=m(E);var f=g.length;let C=!1;if(A){var R=fe(i)===le;R!==(f===0)&&(i=B(),x(i),Z(!1),C=!0)}for(var _=new Set,P=ge,D=pe(),S=0;S<f;S+=1){A&&L.nodeType===de&&L.data===he&&(i=L,C=!0,Z(!1));var I=g[S],$=s(I,S),v=p?null:d.get($);v?(v.v&&K(v.v,I),v.i&&K(v.i,S),D&&P.unskip_effect(v.e)):(v=Me(d,p?i:V??=G(),I,$,S,o,r,t),p||(v.e.f|=N),d.set($,v)),_.add($)}if(f===0&&u&&!c&&(p?c=J(()=>u(i)):(c=J(()=>u(V??=G())),c.f|=N)),f>_.size&&ve(),A&&f>0&&x(B()),!p)if(D){for(const[ie,oe]of d)_.has(ie)||P.skip_effect(oe.e);P.oncommit(b),P.ondiscard(()=>{})}else b();C&&Z(!0),m(E)}),n={effect:w,items:d,outrogroups:null,fallback:c};p=!1,A&&(i=L)}function M(e){for(;e!==null&&(e.f&ye)===0;)e=e.next;return e}function He(e,r,t,s,o){var u=(s&Ne)!==0,i=r.length,d=e.items,a=M(e.effect.first),h,c=null,E,g=[],p=[],b,w,n,f;if(u)for(f=0;f<i;f+=1)b=r[f],w=o(b,f),n=d.get(w).e,(n.f&N)===0&&(n.nodes?.a?.measure(),(E??=new Set).add(n));for(f=0;f<i;f+=1){if(b=r[f],w=o(b,f),n=d.get(w).e,e.outrogroups!==null)for(const v of e.outrogroups)v.pending.delete(n),v.done.delete(n);if((n.f&N)!==0)if(n.f^=N,n===a)z(n,null,t);else{var C=c?c.next:a;n===e.effect.last&&(e.effect.last=n.prev),n.prev&&(n.prev.next=n.next),n.next&&(n.next.prev=n.prev),O(e,c,n),O(e,n,C),z(n,C,t),c=n,g=[],p=[],a=M(c.next);continue}if((n.f&k)!==0&&(ee(n),u&&(n.nodes?.a?.unfix(),(E??=new Set).delete(n))),n!==a){if(h!==void 0&&h.has(n)){if(g.length<p.length){var R=p[0],_;c=R.prev;var P=g[0],D=g[g.length-1];for(_=0;_<g.length;_+=1)z(g[_],R,t);for(_=0;_<p.length;_+=1)h.delete(p[_]);O(e,P.prev,D.next),O(e,c,P),O(e,D,R),a=R,c=D,f-=1,g=[],p=[]}else h.delete(n),z(n,a,t),O(e,n.prev,n.next),O(e,n,c===null?e.effect.first:c.next),O(e,c,n),c=n;continue}for(g=[],p=[];a!==null&&a!==n;)(h??=new Set).add(a),p.push(a),a=M(a.next);if(a===null)continue}(n.f&N)===0&&g.push(n),c=n,a=M(n.next)}if(e.outrogroups!==null){for(const v of e.outrogroups)v.pending.size===0&&(F(q(v.done)),e.outrogroups?.delete(v));e.outrogroups.size===0&&(e.outrogroups=null)}if(a!==null||h!==void 0){var S=[];if(h!==void 0)for(n of h)(n.f&k)===0&&S.push(n);for(;a!==null;)(a.f&k)===0&&a!==e.fallback&&S.push(a),a=M(a.next);var I=S.length;if(I>0){var $=(s&j)!==0&&i===0?t:null;if(u){for(f=0;f<I;f+=1)S[f].nodes?.a?.measure();for(f=0;f<I;f+=1)S[f].nodes?.a?.fix()}$e(e,S,$)}}u&&te(()=>{if(E!==void 0)for(n of E)n.nodes?.a?.apply()})}function Me(e,r,t,s,o,u,i,d){var a=(i&_e)!==0?(i&Ee)===0?Te(t,!1,!1):U(t):null,h=(i&Ae)!==0?U(o):null;return{v:a,i:h,e:J(()=>(u(r,a??t,h??o,d),()=>{e.delete(s)}))}}function z(e,r,t){if(e.nodes)for(var s=e.nodes.start,o=e.nodes.end,u=r&&(r.f&N)===0?r.nodes.start:t;s!==null;){var i=Pe(s);if(u.before(s),s===o)return;s=i}}function O(e,r,t){r===null?e.effect.first=t:r.next=t,t===null?e.effect.last=r:t.prev=r}const X=[...` 	
\r\fÂ \v\uFEFF`];function ze(e,r,t){var s=e==null?"":""+e;if(r&&(s=s?s+" "+r:r),t){for(var o of Object.keys(t))if(t[o])s=s?s+" "+o:o;else if(s.length)for(var u=o.length,i=0;(i=s.indexOf(o,i))>=0;){var d=i+u;(i===0||X.includes(s[i-1]))&&(d===s.length||X.includes(s[d]))?s=(i===0?"":s.substring(0,i))+s.substring(d+1):i=d}}return s===""?null:s}function Ve(e,r,t,s,o,u){var i=e.__className;if(A||i!==t||i===void 0){var d=ze(t,s,u);(!A||d!==e.getAttribute("class"))&&(d==null?e.removeAttribute("class"):e.className=d),e.__className=t}else if(u&&o!==u)for(var a in u){var h=!!u[a];(o==null||h!==!!o[a])&&e.classList.toggle(a,h)}return u}const Le=Symbol("is custom element"),Ge=Symbol("is html"),xe=se?"link":"LINK",Ze=se?"progress":"PROGRESS";function Xe(e){if(A){var r=!1,t=()=>{if(!r){if(r=!0,e.hasAttribute("value")){var s=e.value;Q(e,"value",null),e.value=s}if(e.hasAttribute("checked")){var o=e.checked;Q(e,"checked",null),e.checked=o}}};e.__on_r=t,te(t),Ce()}}function Qe(e,r){var t=ne(e);t.value===(t.value=r??void 0)||e.value===r&&(r!==0||e.nodeName!==Ze)||(e.value=r??"")}function Q(e,r,t,s){var o=ne(e);A&&(o[r]=e.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&e.nodeName===xe)||o[r]!==(o[r]=t)&&(r==="loading"&&(e[Re]=t),t==null?e.removeAttribute(r):typeof t!="string"&&ke(e).includes(r)?e[r]=t:e.setAttribute(r,t))}function ne(e){return e.__attributes??={[Le]:e.nodeName.includes("-"),[Ge]:e.namespaceURI===Ie}}var W=new Map;function ke(e){var r=e.getAttribute("is")||e.nodeName,t=W.get(r);if(t)return t;W.set(r,t=[]);for(var s,o=e,u=Element.prototype;u!==o;){s=De(o);for(var i in s)s[i].set&&t.push(i);o=we(o)}return t}const Je="/api";class Fe extends Error{constructor(r,t,s){super(r),this.status=t,this.data=s,this.name="APIError"}}async function l(e,r={}){const t=`${Je}${e}`,s=await fetch(t,{...r,headers:{"Content-Type":"application/json",...r.headers}});if(!s.ok){const o=await s.text();throw new Fe(`API request failed: ${s.statusText}`,s.status,o)}return s.status===204?{}:s.json()}const qe={getState(){return l("/")},getSources(){return l("/sources")},getSource(e){return l(`/sources/${e}`)},updateSource(e,r){return l(`/sources/${e}`,{method:"PATCH",body:JSON.stringify(r)})},getZones(){return l("/zones")},getZone(e){return l(`/zones/${e}`)},updateZone(e,r){return l(`/zones/${e}`,{method:"PATCH",body:JSON.stringify(r)})},updateZones(e,r){return l("/zones",{method:"PATCH",body:JSON.stringify({zones:e,update:r})})},getGroups(){return l("/groups")},getGroup(e){return l(`/groups/${e}`)},createGroup(e){return l("/group",{method:"POST",body:JSON.stringify(e)})},updateGroup(e,r){return l(`/groups/${e}`,{method:"PATCH",body:JSON.stringify(r)})},deleteGroup(e){return l(`/groups/${e}`,{method:"DELETE"})},getStreams(){return l("/streams")},getStream(e){return l(`/streams/${e}`)},createStream(e){return l("/stream",{method:"POST",body:JSON.stringify(e)})},updateStream(e,r){return l(`/streams/${e}`,{method:"PATCH",body:JSON.stringify(r)})},deleteStream(e){return l(`/streams/${e}`,{method:"DELETE"})},execStreamCommand(e,r){return l(`/streams/${e}/${r}`,{method:"POST"})},getPresets(){return l("/presets")},getPreset(e){return l(`/presets/${e}`)},createPreset(e){return l("/preset",{method:"POST",body:JSON.stringify(e)})},updatePreset(e,r){return l(`/presets/${e}`,{method:"PATCH",body:JSON.stringify(r)})},deletePreset(e){return l(`/presets/${e}`,{method:"DELETE"})},loadPreset(e){return l(`/presets/${e}/load`,{method:"POST"})},getInfo(){return l("/info")},factoryReset(){return l("/factory_reset",{method:"POST"})}};class Be{#e=y(H([]));get sources(){return m(this.#e)}set sources(r){T(this.#e,r,!0)}#r=y(H([]));get zones(){return m(this.#r)}set zones(r){T(this.#r,r,!0)}#t=y(H([]));get groups(){return m(this.#t)}set groups(r){T(this.#t,r,!0)}#s=y(H([]));get streams(){return m(this.#s)}set streams(r){T(this.#s,r,!0)}#n=y(H([]));get presets(){return m(this.#n)}set presets(r){T(this.#n,r,!0)}#i=y(null);get info(){return m(this.#i)}set info(r){T(this.#i,r,!0)}#o=y(!0);get loading(){return m(this.#o)}set loading(r){T(this.#o,r,!0)}#a=y(null);get error(){return m(this.#a)}set error(r){T(this.#a,r,!0)}#u=y(!1);get connected(){return m(this.#u)}set connected(r){T(this.#u,r,!0)}eventSource=null;reconnectTimeout=null;reconnectDelay=1e3;maxReconnectDelay=3e4;async connect(){this.loading=!0,this.error=null;try{const r=await qe.getState();this.updateState(r),this.connected=!0,this.startEventSource()}catch(r){this.error=r instanceof Error?r.message:"Failed to connect",this.connected=!1,this.scheduleReconnect()}finally{this.loading=!1}}startEventSource(){this.eventSource&&this.eventSource.close(),this.eventSource=new EventSource("/api/subscribe"),this.eventSource.onmessage=r=>{try{const t=JSON.parse(r.data);this.updateState(t),this.connected=!0,this.error=null,this.reconnectDelay=1e3}catch(t){console.error("Failed to parse SSE event:",t)}},this.eventSource.onerror=()=>{this.connected=!1,this.eventSource?.close(),this.eventSource=null,this.scheduleReconnect()}}scheduleReconnect(){this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.reconnectTimeout=setTimeout(()=>{console.log(`Reconnecting to SSE (delay: ${this.reconnectDelay}ms)...`),this.connect(),this.reconnectDelay=Math.min(this.reconnectDelay*2,this.maxReconnectDelay)},this.reconnectDelay)}updateState(r){this.sources=r.sources||[],this.zones=r.zones||[],this.groups=r.groups||[],this.streams=r.streams||[],this.presets=r.presets||[],this.info=r.info}disconnect(){this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.connected=!1}getZone(r){return this.zones.find(t=>t.id===r)}getSource(r){return this.sources.find(t=>t.id===r)}getGroup(r){return this.groups.find(t=>t.id===r)}getStream(r){return this.streams.find(t=>t.id===r)}getZoneSource(r){return this.getSource(r.source_id)}getZonesBySource(r){return this.zones.filter(t=>t.source_id===r&&!t.disabled)}getGroupZones(r){return r.zones.map(t=>this.getZone(t)).filter(t=>t!==void 0)}#c=Y(()=>this.zones.filter(r=>!r.disabled&&r.source_id>=0));get activeZones(){return m(this.#c)}set activeZones(r){T(this.#c,r)}#f=Y(()=>this.sources.filter(r=>this.zones.some(t=>t.source_id===r.id&&!t.disabled)));get activeSources(){return m(this.#f)}set activeSources(r){T(this.#f,r)}}const We=new Be;export{We as a,Ve as b,Qe as c,qe as d,Ye as e,Ue as i,Xe as r,Q as s};
