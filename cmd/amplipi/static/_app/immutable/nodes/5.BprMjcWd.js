import{d as Xe,a as f,f as h,c as Te,s as m,b as G,t as Pe}from"../chunks/C9jWRzeA.js";import{p as Ye,a as Ve,b as je,c as ze,f as r,e as d,g as e,r as s,u as A,i as Ae,y as xe,h as I,s as et}from"../chunks/BUyZVbJa.js";import{i as Z}from"../chunks/CajUpCd9.js";import{e as Q,a as b,r as _e,b as me,c as fe,d as T}from"../chunks/GxhOYdm0.js";import{i as Ze,s as Fe}from"../chunks/DZldWtOb.js";import{f as tt}from"../chunks/YAhfXvOw.js";var at=h("<option> <!></option>"),rt=h('<p class="mt-1 text-xs text-purple-600 dark:text-purple-400"> </p>'),st=h('<div class="rounded-lg border border-gray-200 bg-white p-3 dark:border-gray-700 dark:bg-gray-800"><div class="mb-3 flex items-start justify-between"><div class="flex-1"><h4 class="text-sm font-semibold text-gray-900 dark:text-white"> </h4> <p class="text-xs text-purple-600 dark:text-purple-400">Source controlled by group</p></div> <button><span class="text-lg"> </span></button></div> <div class="space-y-1"><div class="flex items-center justify-between"><span class="text-xs font-medium text-gray-700 dark:text-gray-300">Volume</span> <span class="text-xs text-gray-600 dark:text-gray-400"> </span></div> <input type="range" min="0" max="100" class="w-full accent-blue-600"/></div></div>'),dt=h('<div class="space-y-3 border-t border-purple-200 pt-4 dark:border-purple-800"><h4 class="text-xs font-semibold uppercase text-purple-700 dark:text-purple-400">Member Zones</h4> <!></div>'),ot=h('<div class="rounded-lg border border-purple-200 bg-purple-50 p-4 shadow-sm dark:border-purple-800 dark:bg-purple-900/20"><div class="mb-4"><div class="mb-2 flex items-start justify-between"><button class="flex-1 text-left"><h3 class="font-semibold text-purple-900 dark:text-purple-300"> </h3> <p class="text-sm text-purple-700 dark:text-purple-400"> </p></button> <button><span class="text-2xl"> </span></button></div> <div class="space-y-2"><div class="flex items-center justify-between"><span class="text-sm font-medium text-purple-700 dark:text-purple-300">Group Volume</span> <span class="text-sm text-purple-600 dark:text-purple-400"> </span></div> <input type="range" min="0" max="100" class="w-full accent-purple-600"/> <div class="flex items-center justify-between text-xs text-purple-500 dark:text-purple-400"><span>0%</span> <span>100%</span></div></div></div> <div class="mt-3"><label class="mb-1 block text-sm font-medium text-purple-700 dark:text-purple-300">Group Input</label> <select class="w-full rounded border border-purple-300 bg-white px-2 py-1 text-sm focus:border-purple-500 focus:ring-2 focus:ring-purple-500 dark:border-purple-700 dark:bg-purple-900/30 dark:text-white"><option>No input</option><!></select> <!></div> <!></div>'),nt=h('<p class="text-sm text-gray-600 dark:text-gray-400"> </p>'),it=h('<p class="text-sm text-gray-500 dark:text-gray-500">No source</p>'),lt=h("<option> <!></option>"),ut=h('<div class="rounded-lg border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800"><div class="mb-4 flex items-start justify-between"><div class="flex-1"><h3 class="font-semibold text-gray-900 dark:text-white"> </h3> <!></div> <button><span class="text-2xl"> </span></button></div> <div class="space-y-2"><div class="flex items-center justify-between"><span class="text-sm font-medium text-gray-700 dark:text-gray-300">Volume</span> <span class="text-sm text-gray-600 dark:text-gray-400"> </span></div> <input type="range" min="0" max="100" class="w-full accent-blue-600"/> <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"><span>0%</span> <span>100%</span></div></div> <div class="mt-4"><label class="mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300">Input</label> <select class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"><option>None</option><!></select></div></div>'),ct=h('<div class="rounded-lg border-2 border-dashed border-gray-300 p-12 text-center dark:border-gray-700"><p class="text-gray-500 dark:text-gray-400">No zones available</p></div>'),vt=h('<div class="p-4 md:p-6"><div class="mb-6"><h2 class="text-2xl font-bold text-gray-900 dark:text-white">Zones & Groups</h2> <p class="text-sm text-gray-600 dark:text-gray-400">Manage audio zones and groups</p></div> <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3"><!> <!></div> <!></div>');function gt(Me,Ne){Ye(Ne,!0);let se=Ve(je(new Set)),be=je(new Map);const ge=A(()=>b.zones.filter(a=>!a.disabled)),ye=A(()=>tt(e(ge),b.groups)),De=A(()=>e(ye).grouped),Ee=A(()=>e(ye).standalone);async function F(a,t){try{await T.updateZone(a,t)}catch(i){console.error("Failed to update zone:",i)}}async function Ce(a,t){if(t==="none"){await T.updateGroup(a,{source_id:-1});return}if(t.startsWith("stream=")){const i=parseInt(t.substring(7)),l=b.getStream(i);if(!l){console.error("Stream not found:",i);return}if(l.type==="rca"&&l.config?.index!==void 0){const v=l.config.index;await T.updateSource(v,{input:t}),await T.updateGroup(a,{source_id:v})}else await T.updateSource(0,{input:t}),await T.updateGroup(a,{source_id:0})}}function Re(a){return b.streams.filter(t=>!t.disabled)}async function he(a,t){const i=performance.now();console.log(`[API] updateGroup(${a}, ${JSON.stringify(t)}) - START`);try{await T.updateGroup(a,t);const l=performance.now()-i;console.log(`[API] updateGroup(${a}) - DONE in ${l.toFixed(1)}ms`)}catch(l){const v=performance.now()-i;console.error(`[API] updateGroup(${a}) - FAILED after ${v.toFixed(1)}ms:`,l)}}function de(a){return Math.round(a*100)}function Be(a){const t=new Set(e(se));t.has(a)?t.delete(a):t.add(a),et(se,t,!0)}function U(a,t=-79,i=0){return Math.round((a-t)/(i-t)*100)}function ke(a,t=-79,i=0){return Math.round(t+a/100*(i-t))}function Oe(a){return b.streams.filter(t=>!t.disabled)}async function We(a,t){if(t==="none"){await F(a,{source_id:-1});return}if(t.startsWith("stream=")){const i=parseInt(t.substring(7)),l=b.getStream(i);if(!l){console.error("Stream not found:",i);return}if(l.type==="rca"&&l.config?.index!==void 0){const v=l.config.index;await T.updateSource(v,{input:t}),await F(a,{source_id:v,mute:!1})}else{const v=b.zones.find(M=>M.id===a),P=v&&v.source_id>=0?v.source_id:0;await T.updateSource(P,{input:t}),await F(a,{source_id:P,mute:!1})}}}var oe=vt(),ne=d(r(oe),2),we=r(ne);Q(we,17,()=>b.groups,a=>a.id,(a,t)=>{const i=A(()=>e(De).get(e(t).id)||[]),l=A(()=>e(se).has(e(t).id));var v=Te(),P=Ae(v);{var M=C=>{var R=ot(),B=r(R),O=r(B),w=r(O),N=r(w),X=r(N);s(N);var Y=d(N,2),W=r(Y);s(Y),s(w);var j=d(w,2);let J;var V=r(j),L=r(V,!0);s(V),s(j),s(O);var q=d(O,2),g=r(q),D=d(r(g),2),ie=r(D);s(D),s(g);var E=d(g,2);_e(E),xe(2),s(q),s(B);var u=d(B,2),o=d(r(u),2),p=r(o);p.value=p.__value="none";var z=d(p);Q(z,17,()=>Re(e(t)),x=>x.id,(x,c)=>{var _=at(),y=r(_),n=d(y);{var $=S=>{var K=Pe();I(()=>m(K,`(RCA Input ${e(c).config.index+1})`)),f(S,K)};Z(n,S=>{e(c).type==="rca"&&e(c).config?.index!==void 0&&S($)})}s(_);var k={};I(()=>{m(y,`${e(c).name??""} `),k!==(k=`stream=${e(c).id??""}`)&&(_.value=_.__value=`stream=${e(c).id??""}`)}),f(x,_)}),s(o);var ee;Ze(o);var le=d(o,2);{var te=x=>{const c=A(()=>b.getSource(e(t).source_id));var _=Te(),y=Ae(_);{var n=$=>{var k=rt(),S=r(k);s(k),I(()=>m(S,`All zones in this group play: ${e(c).name??""}`)),f($,k)};Z(y,$=>{e(c)&&$(n)})}f(x,_)};Z(le,x=>{e(t).source_id!==void 0&&e(t).source_id>=0&&x(te)})}s(u);var H=d(u,2);{var ae=x=>{var c=dt(),_=d(r(c),2);Q(_,17,()=>e(i),y=>y.id,(y,n)=>{var $=st(),k=r($),S=r(k),K=r(S),He=r(K,!0);s(K),xe(2),s(S);var re=d(S,2);let $e;var Se=r(re),Ke=r(Se,!0);s(Se),s(re),s(k);var Ge=d(k,2),ue=r(Ge),Ie=d(r(ue),2),Qe=r(Ie);s(Ie),s(ue);var ce=d(ue,2);_e(ce),s(Ge),s($),I((ve,pe)=>{m(He,e(n).name),$e=me(re,1,"rounded p-1 hover:bg-gray-100 dark:hover:bg-gray-700",null,$e,{"text-gray-400":e(n).mute,"text-blue-600":!e(n).mute,"dark:text-blue-400":!e(n).mute}),m(Ke,e(n).mute?"ðŸ”‡":"ðŸ”Š"),m(Qe,`${ve??""}%`),fe(ce,pe)},[()=>U(e(n).vol,e(n).vol_min,e(n).vol_max),()=>U(e(n).vol,e(n).vol_min,e(n).vol_max)]),G("click",re,()=>F(e(n).id,{mute:!e(n).mute})),G("input",ce,ve=>{const pe=parseInt(ve.currentTarget.value),Ue=ke(pe,e(n).vol_min,e(n).vol_max);F(e(n).id,{vol:Ue})}),f(y,$)}),s(c),f(x,c)};Z(H,x=>{e(l)&&x(ae)})}s(R),I((x,c,_)=>{m(X,`${e(l)?"â–¼":"â–¶"} ${e(t).name??""}`),m(W,`${e(i).length??""} zone${e(i).length!==1?"s":""}`),J=me(j,1,"rounded-lg p-2 hover:bg-purple-100 dark:hover:bg-purple-800",null,J,{"text-gray-400":e(t).mute,"text-purple-600":!e(t).mute,"dark:text-purple-400":!e(t).mute}),m(L,e(t).mute?"ðŸ”‡":"ðŸ”Š"),m(ie,`${x??""}%`),fe(E,c),ee!==(ee=_)&&(o.value=(o.__value=_)??"",Fe(o,_))},[()=>de(e(t).vol_f??0),()=>de(e(t).vol_f??0),()=>e(t).source_id!==void 0&&e(t).source_id>=0?b.getSource(e(t).source_id)?.input||"":"none"]),G("click",w,()=>Be(e(t).id)),G("click",j,()=>he(e(t).id,{mute:!e(t).mute})),G("input",E,x=>{const c=parseInt(x.currentTarget.value),_=be.get(e(t).id)??de(e(t).vol_f??0),y=c-_,n=Math.round(y/100*79);console.log(`[Group ${e(t).id}] Slider: ${_}% -> ${c}% (delta: ${y}%, ${n}dB)`),be.set(e(t).id,c),n!==0?(console.log(`[Group ${e(t).id}] Sending vol_delta: ${n}`),he(e(t).id,{vol_delta:n,mute:!1})):console.log(`[Group ${e(t).id}] No change (volDelta === 0)`)}),G("change",o,x=>Ce(e(t).id,x.currentTarget.value)),f(C,R)};Z(P,C=>{e(i).length>0&&C(M)})}f(a,v)});var Je=d(we,2);Q(Je,17,()=>e(Ee),a=>a.id,(a,t)=>{const i=A(()=>b.getSource(e(t).source_id));var l=ut(),v=r(l),P=r(v),M=r(P),C=r(M,!0);s(M);var R=d(M,2);{var B=u=>{var o=nt(),p=r(o,!0);s(o),I(()=>m(p,e(i).name)),f(u,o)},O=u=>{var o=it();f(u,o)};Z(R,u=>{e(i)?u(B):u(O,!1)})}s(P);var w=d(P,2);let N;var X=r(w),Y=r(X,!0);s(X),s(w),s(v);var W=d(v,2),j=r(W),J=d(r(j),2),V=r(J);s(J),s(j);var L=d(j,2);_e(L),xe(2),s(W);var q=d(W,2),g=d(r(q),2),D=r(g);D.value=D.__value="none";var ie=d(D);Q(ie,17,()=>Oe(e(t)),u=>u.id,(u,o)=>{var p=lt(),z=r(p),ee=d(z);{var le=H=>{var ae=Pe();I(()=>m(ae,`(RCA Input ${e(o).config.index+1})`)),f(H,ae)};Z(ee,H=>{e(o).type==="rca"&&e(o).config?.index!==void 0&&H(le)})}s(p);var te={};I(()=>{m(z,`${e(o).name??""} `),te!==(te=`stream=${e(o).id??""}`)&&(p.value=p.__value=`stream=${e(o).id??""}`)}),f(u,p)}),s(g);var E;Ze(g),s(q),s(l),I((u,o,p)=>{m(C,e(t).name),N=me(w,1,"rounded-lg p-2 hover:bg-gray-100 dark:hover:bg-gray-700",null,N,{"text-gray-400":e(t).mute,"text-blue-600":!e(t).mute,"dark:text-blue-400":!e(t).mute}),m(Y,e(t).mute?"ðŸ”‡":"ðŸ”Š"),m(V,`${u??""}%`),fe(L,o),E!==(E=p)&&(g.value=(g.__value=p)??"",Fe(g,p))},[()=>U(e(t).vol,e(t).vol_min,e(t).vol_max),()=>U(e(t).vol,e(t).vol_min,e(t).vol_max),()=>e(t).source_id>=0?b.getSource(e(t).source_id)?.input||"":"none"]),G("click",w,()=>F(e(t).id,{mute:!e(t).mute})),G("input",L,u=>{const o=parseInt(u.currentTarget.value),p=ke(o,e(t).vol_min,e(t).vol_max);F(e(t).id,{vol:p})}),G("change",g,u=>We(e(t).id,u.currentTarget.value)),f(a,l)}),s(ne);var Le=d(ne,2);{var qe=a=>{var t=ct();f(a,t)};Z(Le,a=>{e(ge).length===0&&a(qe)})}s(oe),f(Me,oe),ze()}Xe(["click","input","change"]);export{gt as component};
