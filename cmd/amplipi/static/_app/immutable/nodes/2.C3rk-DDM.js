import{d as se,a as c,f as m,s as g,b as N,e as ne,r as oe,c as de}from"../chunks/C9jWRzeA.js";import{p as ie,a as le,b as Pt,c as ve,e as l,f as s,r,g as t,h as w,u as J,i as pt,s as ue}from"../chunks/BUyZVbJa.js";import{i as $}from"../chunks/CajUpCd9.js";import{e as L,a as j,s as ce,r as xt,b as K,c as gt,d as mt}from"../chunks/GxhOYdm0.js";import{i as pe,s as xe}from"../chunks/DZldWtOb.js";import{g as ge,f as me}from"../chunks/YAhfXvOw.js";var _e=m('<img alt="Now playing" class="h-12 w-12 flex-shrink-0 rounded object-cover"/>'),fe=m('<p class="text-xs text-gray-500 dark:text-gray-400 truncate"> </p>'),be=m('<p class="text-sm font-medium text-gray-900 dark:text-white truncate"> </p> <!>',1),ye=m('<p class="text-sm text-gray-600 dark:text-gray-400"> </p>'),he=m("<span> </span>"),ke=m("<!> <!>",1),we=m('<p class="text-sm text-gray-500 dark:text-gray-500">No stream</p>'),Se=m("<option> </option>"),$e=m('<div class="rounded bg-white p-2 dark:bg-gray-800"><div class="mb-1 flex items-center justify-between"><span class="text-xs font-medium text-gray-700 dark:text-gray-300"> </span> <button> </button></div> <div class="flex items-center gap-1"><span class="text-xs text-gray-500 dark:text-gray-400"> </span> <input type="range" min="0" max="100" class="flex-1 accent-blue-600"/></div></div>'),Ge=m('<div class="space-y-2 border-t border-purple-200 p-3 pt-2 dark:border-purple-800"></div>'),Te=m('<div class="rounded-lg bg-purple-50 p-3 dark:bg-purple-900/20"><div class="mb-2 flex items-center justify-between"><button class="flex items-center gap-2 text-left"><span class="text-sm font-medium text-purple-900 dark:text-purple-300"> </span> <span class="text-xs text-purple-700 dark:text-purple-400"> </span></button> <button> </button></div> <div class="mb-3 flex items-center gap-2"><span class="text-xs text-purple-700 dark:text-purple-400"> </span> <input type="range" min="0" max="100" class="flex-1 accent-purple-600"/></div> <!></div>'),Pe=m('<div class="rounded-lg bg-gray-50 p-3 dark:bg-gray-700/50"><div class="mb-2 flex items-center justify-between"><span class="text-sm font-medium text-gray-900 dark:text-white"> </span> <button> </button></div> <div class="flex items-center gap-2"><span class="text-xs text-gray-500 dark:text-gray-400"> </span> <input type="range" min="0" max="100" class="flex-1 accent-blue-600"/></div></div>'),Ne=m('<div class="space-y-3"><!> <!></div>'),Ae=m('<div class="rounded-lg bg-gray-50 p-4 text-center dark:bg-gray-700/50"><p class="text-sm text-gray-500 dark:text-gray-400">No zones connected</p></div>'),Ie=m('<div class="rounded-lg border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800"><div class="mb-4"><div class="mb-2 flex items-start justify-between gap-2"><div class="flex items-start gap-2 flex-1 min-w-0"><!> <div class="flex-1 min-w-0"><h3 class="font-semibold text-gray-900 dark:text-white"> </h3> <!></div></div> <span class="rounded-full bg-blue-100 px-2 py-1 text-xs font-medium text-blue-700 dark:bg-blue-900/20 dark:text-blue-400 flex-shrink-0"> </span></div> <div><select class="w-full rounded border border-gray-300 bg-white px-2 py-1 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"><option>No stream</option><!></select></div></div> <!></div>'),Ze=m('<div class="rounded-lg border-2 border-dashed border-gray-300 p-12 text-center dark:border-gray-700"><p class="text-gray-500 dark:text-gray-400">No sources available</p></div>'),Fe=m('<div class="p-4 md:p-6"><div class="mb-6"><h2 class="text-2xl font-bold text-gray-900 dark:text-white">Sources</h2> <p class="text-sm text-gray-600 dark:text-gray-400">Control your audio sources and zones</p></div> <div class="grid gap-4 md:grid-cols-2 xl:grid-cols-4"></div> <!></div>');function Oe(Nt,At){ie(At,!0);let Q=le(Pt(new Set)),_t=Pt(new Map);async function R(e,n){try{await mt.updateZone(e,n)}catch(i){console.error("Failed to update zone:",i)}}async function ft(e,n){const i=performance.now();console.log(`[API] updateGroup(${e}, ${JSON.stringify(n)}) - START`);try{await mt.updateGroup(e,n);const p=performance.now()-i;console.log(`[API] updateGroup(${e}) - DONE in ${p.toFixed(1)}ms`)}catch(p){const D=performance.now()-i;console.error(`[API] updateGroup(${e}) - FAILED after ${D.toFixed(1)}ms:`,p)}}function U(e){return Math.round(e*100)}async function It(e,n){try{await mt.updateSource(e,{input:n})}catch(i){console.error("Failed to update source input:",i)}}async function Zt(e,n){const i=n>=0?`stream=${n}`:"";await It(e,i)}function Ft(e){const n=new Set(t(Q));n.has(e)?n.delete(e):n.add(e),ue(Q,n,!0)}function jt(e){if(!e.input.startsWith("stream="))return null;const n=parseInt(e.input.replace("stream=",""));return j.getStream(n)}function Dt(e){return e.input.startsWith("stream=")?parseInt(e.input.replace("stream=","")):-1}function Et(e){return j.zones.filter(n=>n.source_id===e.id&&!n.disabled)}function Mt(e){const n=Et(e),i=ge(e.id,j.zones,j.groups),{grouped:p,standalone:D}=me(n,i);return{groups:i,grouped:p,standalone:D}}function q(e,n=-79,i=0){return Math.round((e-n)/(i-n)*100)}function bt(e,n=-79,i=0){return Math.round(n+e/100*(i-n))}var V=Fe(),X=l(s(V),2);L(X,21,()=>j.sources,e=>e.id,(e,n)=>{const i=J(()=>{const{groups:o,grouped:d,standalone:_}=Mt(t(n));return{groups:o,grouped:d,standalone:_}}),p=J(()=>jt(t(n))),D=J(()=>t(i).standalone.length+Array.from(t(i).grouped.values()).reduce((o,d)=>o+d.length,0));var Y=Ie(),z=s(Y),tt=s(z),et=s(tt),yt=s(et);{var Ot=o=>{var d=_e();w(()=>ce(d,"src",t(p).info.img_url)),ne("error",d,_=>_.currentTarget.style.display="none"),oe(d),c(o,d)};$(yt,o=>{t(p)?.info?.img_url&&o(Ot)})}var ht=l(yt,2),at=s(ht),Wt=s(at,!0);r(at);var Jt=l(at,2);{var Lt=o=>{var d=ke(),_=pt(d);{var C=x=>{var u=be(),y=pt(u),G=s(y,!0);r(y);var T=l(y,2);{var I=k=>{var b=fe(),Z=s(b,!0);r(b),w(()=>g(Z,t(p).info.artist)),c(k,b)};$(T,k=>{t(p).info.artist&&k(I)})}w(()=>g(G,t(p).info.track)),c(x,u)},f=x=>{var u=ye(),y=s(u,!0);r(u),w(()=>g(y,t(p).name)),c(x,u)};$(_,x=>{t(p).info?.track?x(C):x(f,!1)})}var a=l(_,2);{var h=x=>{var u=he(),y=s(u,!0);r(u),w(()=>{K(u,1,`mt-1 inline-block rounded px-2 py-0.5 text-xs font-medium ${t(p).info.state==="playing"?"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300"}`),g(y,t(p).info.state)}),c(x,u)};$(a,x=>{t(p).info?.state&&x(h)})}c(o,d)},Rt=o=>{var d=we();c(o,d)};$(Jt,o=>{t(p)?o(Lt):o(Rt,!1)})}r(ht),r(et);var kt=l(et,2),qt=s(kt);r(kt),r(tt);var wt=l(tt,2),A=s(wt),rt=s(A);rt.value=rt.__value=-1;var Ht=l(rt);L(Ht,17,()=>j.streams,o=>o.id,(o,d)=>{var _=Se(),C=s(_);r(_);var f={};w(()=>{g(C,`${t(d).name??""} (${t(d).type??""})`),f!==(f=t(d).id)&&(_.value=(_.__value=t(d).id)??"")}),c(o,_)}),r(A);var St;pe(A),r(wt),r(z);var Kt=l(z,2);{var Qt=o=>{var d=Ne(),_=s(d);L(_,17,()=>t(i).groups,f=>f.id,(f,a)=>{const h=J(()=>t(i).grouped.get(t(a).id)||[]),x=J(()=>t(Q).has(t(a).id));var u=de(),y=pt(u);{var G=T=>{var I=Te(),k=s(I),b=s(k),Z=s(b),O=s(Z);r(Z);var E=l(Z,2),W=s(E);r(E),r(b);var M=l(b,2);let $t;var Vt=s(M,!0);r(M),r(k);var st=l(k,2),nt=s(st),Xt=s(nt);r(nt);var ot=l(nt,2);xt(ot),r(st);var Yt=l(st,2);{var zt=F=>{var S=Ge();L(S,21,()=>t(h),B=>B.id,(B,v)=>{var P=$e(),dt=s(P),it=s(dt),te=s(it,!0);r(it);var H=l(it,2);let Gt;var ee=s(H,!0);r(H),r(dt);var Tt=l(dt,2),lt=s(Tt),ae=s(lt);r(lt);var vt=l(lt,2);xt(vt),r(Tt),r(P),w((ut,ct)=>{g(te,t(v).name),Gt=K(H,1,"rounded p-0.5 text-xs hover:bg-gray-100 dark:hover:bg-gray-700",null,Gt,{"text-gray-400":t(v).mute,"text-blue-600":!t(v).mute,"dark:text-blue-400":!t(v).mute}),g(ee,t(v).mute?"ðŸ”‡":"ðŸ”Š"),g(ae,`${ut??""}%`),gt(vt,ct)},[()=>q(t(v).vol,t(v).vol_min,t(v).vol_max),()=>q(t(v).vol,t(v).vol_min,t(v).vol_max)]),N("click",H,()=>R(t(v).id,{mute:!t(v).mute})),N("input",vt,ut=>{const ct=parseInt(ut.currentTarget.value),re=bt(ct,t(v).vol_min,t(v).vol_max);R(t(v).id,{vol:re})}),c(B,P)}),r(S),c(F,S)};$(Yt,F=>{t(x)&&F(zt)})}r(I),w((F,S)=>{g(O,`${t(x)?"â–¼":"â–¶"} ${t(a).name??""}`),g(W,`(${t(h).length??""} zone${t(h).length!==1?"s":""})`),$t=K(M,1,"rounded p-1 hover:bg-purple-100 dark:hover:bg-purple-800",null,$t,{"text-gray-400":t(a).mute,"text-purple-600":!t(a).mute,"dark:text-purple-400":!t(a).mute}),g(Vt,t(a).mute?"ðŸ”‡":"ðŸ”Š"),g(Xt,`${F??""}%`),gt(ot,S)},[()=>U(t(a).vol_f??0),()=>U(t(a).vol_f??0)]),N("click",b,()=>Ft(t(a).id)),N("click",M,()=>ft(t(a).id,{mute:!t(a).mute})),N("input",ot,F=>{const S=parseInt(F.currentTarget.value),B=_t.get(t(a).id)??U(t(a).vol_f??0),v=S-B,P=Math.round(v/100*79);console.log(`[Group ${t(a).id}] Slider: ${B}% -> ${S}% (delta: ${v}%, ${P}dB)`),_t.set(t(a).id,S),P!==0?(console.log(`[Group ${t(a).id}] Sending vol_delta: ${P}`),ft(t(a).id,{vol_delta:P,mute:!1})):console.log(`[Group ${t(a).id}] No change (volDelta === 0)`)}),c(T,I)};$(y,T=>{t(h).length>0&&T(G)})}c(f,u)});var C=l(_,2);L(C,17,()=>t(i).standalone,f=>f.id,(f,a)=>{var h=Pe(),x=s(h),u=s(x),y=s(u,!0);r(u);var G=l(u,2);let T;var I=s(G,!0);r(G),r(x);var k=l(x,2),b=s(k),Z=s(b);r(b);var O=l(b,2);xt(O),r(k),r(h),w((E,W)=>{g(y,t(a).name),T=K(G,1,"rounded p-1 hover:bg-gray-200 dark:hover:bg-gray-600",null,T,{"text-gray-400":t(a).mute,"text-blue-600":!t(a).mute,"dark:text-blue-400":!t(a).mute}),g(I,t(a).mute?"ðŸ”‡":"ðŸ”Š"),g(Z,`${E??""}%`),gt(O,W)},[()=>q(t(a).vol,t(a).vol_min,t(a).vol_max),()=>q(t(a).vol,t(a).vol_min,t(a).vol_max)]),N("click",G,()=>R(t(a).id,{mute:!t(a).mute})),N("input",O,E=>{const W=parseInt(E.currentTarget.value),M=bt(W,t(a).vol_min,t(a).vol_max);R(t(a).id,{vol:M})}),c(f,h)}),r(d),c(o,d)},Ut=o=>{var d=Ae();c(o,d)};$(Kt,o=>{t(i).groups.length>0||t(i).standalone.length>0?o(Qt):o(Ut,!1)})}r(Y),w(o=>{g(Wt,t(n).name),g(qt,`${t(D)??""} zone${t(D)!==1?"s":""}`),St!==(St=o)&&(A.value=(A.__value=o)??"",xe(A,o))},[()=>Dt(t(n))]),N("change",A,o=>Zt(t(n).id,parseInt(o.currentTarget.value))),c(e,Y)}),r(X);var Bt=l(X,2);{var Ct=e=>{var n=Ze();c(e,n)};$(Bt,e=>{j.sources.length===0&&e(Ct)})}r(V),c(Nt,V),ve()}se(["change","click","input"]);export{Oe as component};
